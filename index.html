<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Parqueadero PPPB</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
    <div class="container">
        <section id="login-section" class="login-section">
            <h2>Iniciar Sesión</h2>
            <div class="input-group">
                <label for="username">Usuario:</label>
                <input type="text" id="username" placeholder="Usuario o Placa" required>
            </div>
            <div class="input-group">
                <label for="password">Contraseña:</label>
                <input type="password" id="password" placeholder="Contraseña" required>
            </div>
            <button id="btnEntrar">Entrar</button>
            <div id="login-error" class="error-message"></div>
        </section>

        <section id="app" style="display: none;">
            <header>
                <h1>Parqueadero PPPB</h1>
                <button id="btnCerrarSesion" style="display: none;">Cerrar Sesión</button>
            </header>

            <div id="admin-panel" style="display: none;">
                <nav class="main-nav">
                    <ul>
                        <li id="nav-calculo-horas"><a href="#" onclick="showTab('hora')">Cálculo por Horas</a></li>
                        <li id="nav-mensualidades"><a href="#" onclick="showTab('mensualidades')">Mensualidades</a></li>
                        <li id="nav-mi-perfil"><a href="#" onclick="showTab('perfil-admin')">Mi Perfil (Admin)</a></li>
                    </ul>
                </nav>

                <main class="tab-content-container">
                    <div id="hora" class="tab-content">
                        <h2>Gestión de Parqueo por Horas</h2>
                        <div class="card">
                            <h3>Entrada/Salida de Vehículo</h3>
                            <div class="input-group">
                                <label for="placaProceso">Placa:</label>
                                <input type="text" id="placaProceso" placeholder="Ingrese la placa" maxlength="7" required>
                            </div>
                            <div class="input-group">
                                <label for="tipoVehiculoEntrada">Tipo de Vehículo:</label>
                                <select id="tipoVehiculoEntrada">
                                    <option value="automovil">Automóvil/Camioneta</option>
                                    <option value="moto">Moto</option>
                                    <option value="camion">Camión</option>
                                </select>
                            </div>
                            <button id="btnProcesarPlaca">Procesar Placa</button>
                        </div>

                        <div id="dynamicParkingInfo" class="card" style="display: none;">
                            <h3>Información de Salida</h3>
                            <p><strong>Placa:</strong> <span id="displayPlacaCalculo"></span></p>
                            <p><strong>Entrada:</strong> <span id="displayFechaHoraEntradaDetallada"></span></p>
                            <p><strong>Salida:</strong> <span id="displayFechaHoraSalidaDetallada"></span> (Fecha y Hora Actual)</p>
                            <p><strong>Duración:</strong> <span id="displayTiempoTotalDetallado"></span></p>
                            <p><strong>Tipo de Tarifa Aplicada:</strong> <span id="displayTarifaAplicada"></span></p>
                            <p class="total-cost"><strong>Costo Total:</strong> <span id="displayCostoTotalCalculo">$0</span></p>
                            <button id="btnRegistrarSalidaAccion" style="display: none;">Registrar Salida y Calcular</button>
                            <button id="btnImprimirComprobante" style="display: none;" class="print-btn">Imprimir Comprobante</button>
                        </div>

                        <div class="card">
                            <h3>Vehículos Parqueados Actualmente</h3>
                            <p>Automóviles: <span id="countCars">0</span></p>
                            <p>Motos: <span id="countMotos">0</span></p>
                            <p>Camiones: <span id="countTrucks">0</span></p>
                        </div>

                        <h3>Historial de Parqueo</h3>
                        <div class="table-container">
                            <table id="tablaHistorialAutomated" class="data-table">
                                <thead>
                                    <tr>
                                        <th>Placa</th>
                                        <th>Tipo</th>
                                        <th>Entrada</th>
                                        <th>Salida</th>
                                        <th>Duración</th>
                                        <th>Costo</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    </tbody>
                            </table>
                        </div>
                    </div>

                    <div id="mensualidades" class="tab-content" style="display: none;">
                        <h2>Gestión de Mensualidades</h2>
                        <div class="card">
                            <h3>Registrar Nueva Mensualidad</h3>
                            <div class="input-group">
                                <label for="cliente">Nombre del Cliente:</label>
                                <input type="text" id="cliente" required>
                            </div>
                            <div class="input-group">
                                <label for="placaMensualidad">Placa del Vehículo:</label>
                                <input type="text" id="placaMensualidad" maxlength="7" required>
                            </div>
                            <div class="input-group">
                                <label for="tipoMensualidad">Tipo de Vehículo:</label>
                                <select id="tipoMensualidad">
                                    <option value="automovil">Automóvil/Camioneta</option>
                                    <option value="moto">Moto</option>
                                    <option value="camion">Camión</option>
                                </select>
                            </div>
                            <div class="input-group">
                                <label for="valorMensualidad">Valor:</label>
                                <input type="number" id="valorMensualidad" min="0" required>
                            </div>
                            <div class="input-group">
                                <label for="fechaPago">Fecha de Pago:</label>
                                <input type="date" id="fechaPago" required>
                            </div>
                            <div class="input-group">
                                <label for="fechaInicio">Vigencia Desde:</label>
                                <input type="date" id="fechaInicio" required>
                            </div>
                            <div class="input-group">
                                <label for="fechaFin">Vigencia Hasta:</label>
                                <input type="date" id="fechaFin" required>
                            </div>
                            <button onclick="registrarMensualidad()">Registrar Mensualidad</button>
                        </div>

                        <h3>Mensualidades Registradas</h3>
                        <div class="table-container">
                            <table id="tablaMensualidades" class="data-table">
                                <thead>
                                    <tr>
                                        <th>Cliente</th>
                                        <th>Placa</th>
                                        <th>Tipo</th>
                                        <th>Valor</th>
                                        <th>Fecha Pago</th>
                                        <th>Vigencia Inicio</th>
                                        <th>Vigencia Fin</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    </tbody>
                            </table>
                        </div>
                    </div>

                    <div id="perfil-admin" class="tab-content" style="display: none;">
                        <h2>Mi Perfil (Administrador)</h2>
                        <nav class="profile-sub-nav">
                            <ul>
                                <li><a href="#" onclick="showProfileSubTab('info-sistema')" class="active-sub-tab">Información del Sistema</a></li>
                                <li><a href="#" onclick="showProfileSubTab('config-tarifas')">Configuración de Tarifas</a></li>
                                <li><a href="#" onclick="showProfileSubTab('cambio-password-admin')">Cambiar Contraseña Admin</a></li>
                                <li><a href="#" onclick="showProfileSubTab('gestion-usuarios')">Gestión de Usuarios Clientes</a></li>
                            </ul>
                        </nav>
                        <div class="profile-sub-tab-content" id="info-sistema">
                            <h3>Información del Sistema</h3>
                            <p>Bienvenido al panel de administración del Parqueadero PPPB.</p>
                            <p>Desde aquí puedes gestionar los parqueos por hora, las mensualidades, configurar tarifas y administrar usuarios.</p>
                            <p><strong>Versión del Sistema:</strong> 1.0.1</p>
                            <p><strong>Última Actualización:</strong> Julio 2025</p>
                        </div>

                        <div class="profile-sub-tab-content" id="config-tarifas" style="display:none;">
                            <h3>Configuración de Tarifas</h3>
                            <p>Ajuste las tarifas de parqueo por tipo de vehículo y las tarifas planas.</p>
                            <div class="form-section">
                                <h4>Tarifas de Moto</h4>
                                <div class="input-group">
                                    <label for="motoPorSegundo">Costo por Hora:</label>
                                    <input type="number" id="motoPorSegundo" step="0.01" min="0">
                                </div>
                                <div class="input-group">
                                    <label for="motoTarifaPlena">Tarifa Plena:</label>
                                    <input type="number" id="motoTarifaPlena" min="0">
                                </div>
                                <div class="input-group">
                                    <label for="motoTiempoTarifaPlena">Tiempo para Tarifa Plena (Horas):</label>
                                    <input type="number" id="motoTiempoTarifaPlena" step="0.1" min="0">
                                </div>
                            </div>

                            <div class="form-section">
                                <h4>Tarifas de Automóvil/Camioneta</h4>
                                <div class="input-group">
                                    <label for="automovilPorSegundo">Costo por Hora:</label>
                                    <input type="number" id="automovilPorSegundo" step="0.01" min="0">
                                </div>
                                <div class="input-group">
                                    <label for="automovilTarifaPlena">Tarifa Plena:</label>
                                    <input type="number" id="automovilTarifaPlena" min="0">
                                </div>
                                <div class="input-group">
                                    <label for="automovilTiempoTarifaPlena">Tiempo para Tarifa Plena (Horas):</label>
                                    <input type="number" id="automovilTiempoTarifaPlena" step="0.1" min="0">
                                </div>
                            </div>

                            <div class="form-section">
                                <h4>Tarifas de Camión</h4>
                                <div class="input-group">
                                    <label for="camionPorSegundo">Costo por Hora:</label>
                                    <input type="number" id="camionPorSegundo" step="0.01" min="0">
                                </div>
                                <div class="input-group">
                                    <label for="camionTarifaPlena">Tarifa Plena:</label>
                                    <input type="number" id="camionTarifaPlena" min="0">
                                </div>
                                <div class="input-group">
                                    <label for="camionTiempoTarifaPlena">Tiempo para Tarifa Plena (Horas):</label>
                                    <input type="number" id="camionTiempoTarifaPlena" step="0.1" min="0">
                                </div>
                            </div>

                            <div class="form-section">
                                <h4>Configuración General</h4>
                                <div class="input-group">
                                    <label for="maxTiempoTarifaPlenaInput">Tiempo Máximo de Tarifa Plena (Horas):</label>
                                    <input type="number" id="maxTiempoTarifaPlenaInput" step="0.1" min="0">
                                </div>
                            </div>
                            <button id="btnGuardarTarifas">Guardar Configuraciones</button>
                        </div>

                        <div class="profile-sub-tab-content" id="cambio-password-admin" style="display:none;">
                            <h3>Cambiar Contraseña del Administrador</h3>
                            <div class="input-group">
                                <label for="adminPassActual">Contraseña Actual:</label>
                                <input type="password" id="adminPassActual" required>
                            </div>
                            <div class="input-group">
                                <label for="adminPassNueva">Nueva Contraseña:</label>
                                <input type="password" id="adminPassNueva" required>
                            </div>
                            <div class="input-group">
                                <label for="adminPassNueva2">Confirmar Nueva Contraseña:</label>
                                <input type="password" id="adminPassNueva2" required>
                            </div>
                            <button id="btnCambiarAdminPass">Cambiar Contraseña</button>
                            <div id="mensajeAdminPass" class="message"></div>
                        </div>

                        <div class="profile-sub-tab-content" id="gestion-usuarios" style="display:none;">
                            <h3>Gestión de Usuarios Clientes</h3>
                            <div class="card">
                                <h4>Buscar y Modificar Cliente</h4>
                                <div class="input-group">
                                    <label for="placaClienteGestion">Placa del Cliente:</label>
                                    <input type="text" id="placaClienteGestion" maxlength="7" required>
                                </div>
                                <button id="btnBuscarCliente">Buscar Cliente</button>
                                <div id="mensajeClienteGestion" class="message"></div>
                            </div>

                            <div id="cliente-info-display" class="card" style="display: none;">
                                <h4>Información del Cliente</h4>
                                <p><strong>Placa:</strong> <span id="displayPlacaClienteGestion"></span></p>
                                <p><strong>Contraseña:</strong> <span id="displayPassClienteGestion"></span> (No se muestra la real por seguridad)</p>
                                <hr>
                                <h4>Restablecer Contraseña</h4>
                                <div class="input-group">
                                    <label for="nuevaPassCliente">Nueva Contraseña:</label>
                                    <input type="password" id="nuevaPassCliente" required>
                                </div>
                                <div class="input-group">
                                    <label for="confirmarNuevaPassCliente">Confirmar Nueva Contraseña:</label>
                                    <input type="password" id="confirmarNuevaPassCliente" required>
                                </div>
                                <button id="btnRestablecerPassCliente">Restablecer Contraseña</button>
                                <div id="mensajeRestablecerPass" class="message"></div>
                            </div>
                        </div>
                    </div>
                </main>
            </div>

            <div id="cliente-panel" style="display: none;">
                <main class="client-panel-main">
                    <h2>Bienvenido, <span id="nombreCliente"></span></h2>
                    <div class="card">
                        <h3>Mis Mensualidades</h3>
                        <div class="table-container">
                            <table id="tablaMensualidadesCliente" class="data-table">
                                <thead>
                                    <tr>
                                        <th>Placa</th>
                                        <th>Tipo</th>
                                        <th>Vigencia Inicio</th>
                                        <th>Vigencia Fin</th>
                                        <th>Valor</th>
                                        <th>Estado/Acciones</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="card">
                        <h3>Cambiar Contraseña</h3>
                        <div class="input-group">
                            <label for="passActual">Contraseña Actual:</label>
                            <input type="password" id="passActual" required onfocus="ocultarMensajePass()">
                        </div>
                        <div class="input-group">
                            <label for="passNueva">Nueva Contraseña:</label>
                            <input type="password" id="passNueva" required onfocus="ocultarMensajePass()">
                        </div>
                        <div class="input-group">
                            <label for="passNueva2">Confirmar Nueva Contraseña:</label>
                            <input type="password" id="passNueva2" required onfocus="ocultarMensajePass()">
                        </div>
                        <button id="btnCambiarPass">Cambiar Contraseña</button>
                        <div id="mensajePass" class="message"></div>
                    </div>
                </main>
            </div>
        </section>
    </div>

    <script src="script.js"></script>
</body>
</html>
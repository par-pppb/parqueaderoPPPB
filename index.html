<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Parqueadero PPPB</title>
    <link rel="stylesheet" href="styles.css">
    <script type="module" src="https://www.gstatic.com/firebasejs/10.0.0/firebase-app.js"></script>
    <script type="module" src="https://www.gstatic.com/firebasejs/10.0.0/firebase-firestore.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script>
</head>
<body>
    <div class="container">
        <h1>Parqueadero PPPB</h1>

        <section id="login-section" class="auth-card">
            <h2>Iniciar Sesión</h2>
            <div class="input-group">
                <label for="username">Usuario / Placa:</label>
                <input type="text" id="username" placeholder="Usuario">
            </div>
            <div class="input-group">
                <label for="password">Contraseña:</label>
                <input type="password" id="password" placeholder="Contraseña">
            </div>
            <button id="login-btn">Ingresar</button>
            <p id="login-message" class="error-message"></p>
        </section>

        <section id="admin-panel" class="hidden">
            <nav class="tabs">
                <button class="tab-button active" data-tab="parqueadero">Parqueadero</button>
                <button class="tab-button" data-tab="mensualidades">Mensualidades</button>
                <button class="tab-button" data-tab="historial">Historial</button>
                <button class="tab-button" data-tab="ajustes">Ajustes</button>
                <button class="tab-button" data-tab="gestion-clientes">Gestión Clientes</button>
                <button id="logout-btn" class="logout-button">Salir</button>
            </nav>

            <div class="tab-content" id="parqueadero">
                <h2>Parqueadero</h2>
                <div class="summary-cards">
                    <div class="summary-card">
                        <h4>Vehículos Actuales</h4>
                        <p id="total-vehiculos-p"></p>
                    </div>
                    <div class="summary-card">
                        <h4>Cupos Disponibles</h4>
                        <p id="cupos-disponibles-p"></p>
                    </div>
                    <div class="summary-card">
                        <h4>Total Generado</h4>
                        <p id="total-generado-p"></p>
                    </div>
                </div>

                <div class="entry-card">
                    <h3>Registrar Entrada</h3>
                    <div class="input-group inline">
                        <label for="placa-entrada">Placa:</label>
                        <input type="text" id="placa-entrada" placeholder="Placa">
                        <label for="tipo-vehiculo-entrada">Tipo:</label>
                        <select id="tipo-vehiculo-entrada">
                            <option value="carro">Carro</option>
                            <option value="moto">Moto</option>
                            <option value="bici">Bici</option>
                        </select>
                        <button id="registrar-entrada-btn">Entrada</button>
                    </div>
                    <p id="entrada-message" class="entry-exit-message"></p>
                </div>

                <div class="exit-card">
                    <h3>Registrar Salida</h3>
                    <div class="input-group inline">
                        <label for="placa-salida">Placa:</label>
                        <input type="text" id="placa-salida" placeholder="Placa">
                        <button id="registrar-salida-btn">Salida</button>
                        <button id="generar-comprobante-btn" class="generar-comprobante-btn hidden">Comprobante</button>
                    </div>
                    <p id="salida-message" class="entry-exit-message"></p>
                </div>

                <h3>Vehículos Parqueados</h3>
                <div class="search-input">
                    <input type="text" id="buscar-parqueados" placeholder="Buscar por placa...">
                    <button onclick="buscarVehiculoParqueado()">Buscar</button>
                </div>
                <table id="parqueados-table">
                    <thead>
                        <tr>
                            <th>Placa</th>
                            <th>Tipo</th>
                            <th>Entrada</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        </tbody>
                </table>
            </div>

            <div class="tab-content hidden" id="mensualidades">
                <h2>Mensualidades</h2>
                <div class="entry-card">
                    <h3>Registrar Mensualidad</h3>
                    <div class="input-group">
                        <label for="placa-mensualidad">Placa:</label>
                        <input type="text" id="placa-mensualidad" placeholder="Placa">
                    </div>
                    <div class="input-group">
                        <label for="tipo-mensualidad">Tipo:</label>
                        <select id="tipo-mensualidad">
                            <option value="carro">Carro</option>
                            <option value="moto">Moto</option>
                            <option value="bici">Bici</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label for="valor-mensualidad">Valor:</label>
                        <input type="number" id="valor-mensualidad" placeholder="Valor">
                    </div>
                    <div class="input-group">
                        <label for="pagador-mensualidad">Pagador:</label>
                        <input type="text" id="pagador-mensualidad" placeholder="Nombre del pagador">
                    </div>
                    <button id="registrar-mensualidad-btn">Registrar Mensualidad</button>
                    <p id="mensualidad-message" class="message"></p>
                </div>

                <h3>Mensualidades Activas</h3>
                <table id="tabla-mensualidades">
                    <thead>
                        <tr>
                            <th>Placa</th>
                            <th>Tipo</th>
                            <th>Pagador</th>
                            <th>Valor</th>
                            <th>Inicio</th>
                            <th>Fin</th>
                            <th>Fecha de Pago</th>
                            <th>Estado</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        </tbody>
                </table>
                <button id="exportar-mensualidades-btn" class="exportar-mensualidades-btn">Exportar a Excel</button>
                
                <h3>Mensualidades Vencidas</h3>
                <table id="tabla-mensualidades-vencidas">
                    <thead>
                        <tr>
                            <th>Placa</th>
                            <th>Tipo</th>
                            <th>Pagador</th>
                            <th>Valor</th>
                            <th>Inicio</th>
                            <th>Fin</th>
                            <th>Estado</th>
                        </tr>
                    </thead>
                    <tbody>
                        </tbody>
                </table>
            </div>

            <div class="tab-content hidden" id="historial">
                <h2>Historial de Parqueo</h2>
                <table id="historial-table">
                    <thead>
                        <tr>
                            <th>Placa</th>
                            <th>Tipo</th>
                            <th>Entrada</th>
                            <th>Salida</th>
                            <th>Tiempo</th>
                            <th>Valor</th>
                        </tr>
                    </thead>
                    <tbody>
                        </tbody>
                </table>
            </div>

            <div class="tab-content hidden" id="ajustes">
                <h2>Ajustes de Tarifas</h2>
                <div class="ajustes-card">
                    <div class="input-group">
                        <label for="tarifa-hora-carro">Tarifa por Hora (Carro):</label>
                        <input type="number" id="tarifa-hora-carro">
                    </div>
                    <div class="input-group">
                        <label for="tarifa-hora-moto">Tarifa por Hora (Moto):</label>
                        <input type="number" id="tarifa-hora-moto">
                    </div>
                    <div class="input-group">
                        <label for="tarifa-hora-bici">Tarifa por Hora (Bici):</label>
                        <input type="number" id="tarifa-hora-bici">
                    </div>
                    <div class="input-group">
                        <label for="cupos-maximos">Cupos Máximos:</label>
                        <input type="number" id="cupos-maximos">
                    </div>
                    <button id="guardar-tarifas-btn">Guardar Ajustes</button>
                    <p id="ajustes-message" class="message"></p>
                </div>
            </div>

            <div class="tab-content hidden" id="gestion-clientes">
                <h2>Gestión de Clientes</h2>
                <div class="auth-card">
                    <h3>Buscar Cliente</h3>
                    <div class="input-group">
                        <label for="placa-cliente">Placa del Cliente:</label>
                        <input type="text" id="placa-cliente" placeholder="Placa">
                    </div>
                    <button id="buscar-cliente-btn">Buscar Cliente</button>
                </div>
                <div id="cliente-info" class="auth-card hidden">
                    <h3>Información del Cliente</h3>
                    <p><strong>Placa:</strong> <span id="cliente-info-placa"></span></p>
                    <p><strong>Contraseña:</strong> <span id="cliente-info-pass"></span></p>
                    <button id="reset-pass-btn" class="reset-pass-btn">Restablecer Contraseña (misma placa)</button>
                </div>
                <p id="cliente-gestion-message" class="message"></p>
            </div>
        </section>

        <section id="client-panel" class="hidden">
            <nav class="tabs">
                <button class="tab-button active" data-tab="mis-mensualidades">Mis Mensualidades</button>
                <button id="logout-btn-client" class="logout-button">Salir</button>
            </nav>

            <div class="tab-content active" id="mis-mensualidades">
                <h3>Mis Mensualidades</h3>
                <table id="client-mensualidades-table">
                    <thead>
                        <tr>
                            <th>Placa</th>
                            <th>Tipo</th>
                            <th>Pagador</th>
                            <th>Valor</th>
                            <th>Inicio</th>
                            <th>Fin</th>
                            <th>Fecha de Pago</th>
                            <th>Estado</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        </tbody>
                </table>
                <p id="client-mensualidades-message" class="message"></p>
            </div>
        </section>
    </div>

    <script type="module" src="script.js"></script>
</body>
</html>
